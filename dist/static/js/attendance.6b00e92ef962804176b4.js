(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"/hRA":function(t,e,n){"use strict";var s=n("RwMa");n.n(s).a},"0TjF":function(t,e,n){},"9Kmz":function(t,e,n){"use strict";n.r(e);var s=n("LvDl"),i=n.n(s),r=n("fntI"),a=n("MSER"),o=n("tjPp"),c={props:{classes:{type:Array,default:function(){return[]}}},data:function(){return{state:"displaying"}},watch:{registration:function(){this.state="displaying"}},methods:{toggleState:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"displaying";this.state=t}},components:{AssignmentEdit:r.a,ScoutRegistration:a.a},mixins:[o.a]},u=(n("qvGm"),n("KHd+")),l=Object(u.a)(c,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"attendance-row"},[n("h5",{staticClass:"title is-5"},[t._v("\n    Attendance for "+t._s(t.scout.fullname)+" (Troop "+t._s(t.scout.troop)+")\n    "),"displaying"===t.state?n("button",{staticClass:"button edit-button is-pulled-right",on:{click:function(e){t.toggleState("assigning")}}},[n("span",{staticClass:"fa fa-edit",attrs:{"aria-label":"Edit"}})]):t._e()]),t._v(" "),"displaying"===t.state?n("div",[n("scout-registration",{attrs:{event:t.event,preferences:t.registrationPreferences,purchases:t.registrationPurchases,assignments:t.assignmentList}},[n("p",{attrs:{slot:"assignment-notification"},slot:"assignment-notification"},[t._v("\n        "+t._s(t.scout.fullname)+" has not yet been assigned any merit badges for\n        MBU "+t._s(t.event.semester)+" "+t._s(t.event.year)+".\n        "),n("br"),t._v(" "),n("a",{staticClass:"is-text",on:{click:function(e){e.preventDefault(),t.toggleState("assigning")}}},[t._v("\n          Assign Merit Badges\n        ")])])])],1):t._e(),t._v(" "),"assigning"===t.state?n("assignment-edit",{attrs:{scout:t.scout,classes:t.classes,event:t.event,preferences:t.preferences,registration:t.registration},on:{done:function(e){t.toggleState("displaying")}}}):t._e()],1)},[],!1,null,"33c5f681",null).exports,d=n("fBmq"),f=(n("L2JU"),{props:{event:{type:Object},registrations:{type:Array,required:!0},classes:{type:Array,default:function(){return[]}}},data:function(){return{error:"",loading:!1,search:"",selectedEventId:0,troopFilter:null}},computed:{noRegistrations:function(){return!this.selectedRegistration||this.selectedRegistration.registrations.length<1},troops:function(){return this.selectedRegistration?i.a.uniq(i.a.map(this.selectedRegistration.registrations,"scout.troop")):[]}},watch:{selectedEventId:function(t){var e=this;this.loading=!0,this.troopFilter=null,this.$store.dispatch("getRegistrations",t).then(function(){e.error=""}).catch(function(){e.error="Failed to get registrations for this event"}).then(function(){e.loading=!1})}},components:{AttendanceRow:l},mixins:[d.a]}),g=(n("/hRA"),Object(u.a)(f,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.loading?n("spinner-page"):n("div",{staticClass:"registration-list"},[t.error?n("closable-error",[t._v(t._s(t.error))]):t._e(),t._v(" "),t.registrations.length>0?n("div",[n("paginated-items",{attrs:{target:"registrations",contents:t.registrations,per:10,showLinks:!0},scopedSlots:t._u([{key:"row",fn:function(e){return[n("attendance-row",{attrs:{registration:e.item,event:t.event,classes:t.classes}})]}}])})],1):n("div",{staticClass:"notification"},[n("p",[t._v("\n        There are no scouts that match the criteria you specified.\n      ")])])],1)],1)},[],!1,null,"084b1f2a",null));e.default=g.exports},RwMa:function(t,e,n){},fntI:function(t,e,n){"use strict";var s=n("LvDl"),i=n.n(s),r=n("Jc9L"),a={props:{scout:{type:Object,required:!0},event:{type:Object,required:!0},preferences:{type:Array,default:function(){return[]}},registration:{type:Object,require:!0},classes:{type:Array,default:function(){return[]}}},data:function(){return{assignments:[],saving:!1}},computed:{sortedOfferings:function(){return i.a.orderBy(this.event.offerings,"name")}},methods:{classFull:function(t,e){return this.sizeInfoForOffering(this.event.id,t)[e]>=this.sizeInfoForOffering(this.event.id,t).size_limit},maybeRespondToDuration:function(t,e){var n=i.a.find(this.event.offerings,function(e){return e.details.id===Number(t)});!n||n.details.duration<2||(this.assignments[1]=t,this.assignments[2]=t)},offered:function(t,e){var n=i.a.find(this.event.offerings,function(e){return e.details.id===t});return i.a.indexOf(n.details.periods,e)>=0},setAssignments:function(){var t=this;this.saving=!0;var e=[];i.a.forEach(this.assignments,function(n,s){if(n){var r=i.a.find(e,{offering:n}),a=i.a.find(t.registration.assignments,{offering_id:n});r?r.periods.push(s+1):e.push({periods:[s+1],offering:n,completions:a&&a.details.completions||[]})}}),this.$store.dispatch("setAssignments",{scoutId:this.scout.scout_id,registrationId:this.registration.id,assignments:e,eventId:this.event.id}).then(function(){t.loadClasses(t.event.id)}).then(function(){t.error="",t.$emit("done")}).catch(function(e){t.error="Failed to save assignments. Please refresh and try again"}).then(function(){t.saving=!1})},sizeInfoText:function(t,e){return this.sizeInfoForOffering(this.event.id,t)[e]+" of "+this.sizeInfoForOffering(this.event.id,t).size_limit}},mounted:function(){var t=[null,null,null];i.a.forEach(this.registration.assignments,function(e){return i.a.forEach(e.details.periods,function(n){t[Number(n)-1]=e.offering_id})}),this.assignments=t},mixins:[r.a]},o=(n("yDlJ"),n("KHd+")),c=Object(o.a)(a,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("b",[t._v("Assign Merit Badges")]),t._v(" "),n("p",[t._v("\n    Assign Merit Badges for "+t._s(t.scout.fullname)+" for MBU "+t._s(t.event.semester)+" "+t._s(t.event.year)+" here. Select\n    a merit badge from the dropdown for each period. Merit Badges that are not offered for that period\n    are grayed out.\n  ")]),t._v(" "),n("br"),t._v(" "),n("p",[t._v("\n    "+t._s(t.scout.fullname)+" has listed as their preferences:\n  ")]),t._v(" "),n("ul",t._l(t.preferences,function(e){return n("li",{key:e.offering_id},[t._v("\n      "+t._s(e.details.rank)+": "+t._s(e.badge.name)+"\n      "),"0.00"!==e.price?n("span",[t._v("\n        ("+t._s(t._f("currency")(e.price))+")\n      ")]):t._e()])})),t._v(" "),n("form",{staticClass:"form"},[n("div",{staticClass:"columns"},t._l(3,function(e){return n("div",{key:e,staticClass:"field column is-4"},[n("label",{staticClass:"label",attrs:{for:"period-1-assignment"}},[t._v("Period "+t._s(e)+":")]),t._v(" "),n("div",{staticClass:"control"},[n("span",{staticClass:"input-group select"},[n("select",{directives:[{name:"model",rawName:"v-model",value:t.assignments[e-1],expression:"assignments[n - 1]"}],staticClass:"input",attrs:{id:"period-"+e+"-assignment"},on:{change:[function(n){var s=Array.prototype.filter.call(n.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.assignments,e-1,n.target.multiple?s:s[0])},function(n){t.maybeRespondToDuration(n.target.value,e)}]}},[n("option",{domProps:{value:null}},[t._v("No Assignment")]),t._v(" "),n("option",{attrs:{disabled:""}}),t._v(" "),n("optgroup",{attrs:{label:"Preferences"}},t._l(t.preferences,function(s){return n("option",{key:s.offering_id,attrs:{disabled:!t.offered(s.offering_id,e)||t.classFull(s.offering_id,e)},domProps:{value:s.offering_id}},[t._v("\n                  "+t._s(s.badge.name)+"\n                  "),"0.00"!==s.price?n("span",[t._v("\n                    ("+t._s(t._f("currency")(s.price))+")\n                  ")]):t._e(),t._v(" "),s.duration>1?n("span",[t._v("\n                    ("+t._s(s.duration)+" periods)\n                  ")]):t._e(),t._v(" "),t.sizeInfoForOffering(t.event.id,s.offering_id)?n("span",[t._v("\n                    ("+t._s(t.sizeInfoText(s.offering_id,e))+")\n                  ")]):t._e()])})),t._v(" "),n("option",{attrs:{disabled:""}}),t._v(" "),n("optgroup",{attrs:{label:"All Offerings"}},t._l(t.sortedOfferings,function(s){return n("option",{key:s.details.id,attrs:{disabled:!t.offered(s.details.id,e)||t.classFull(s.details.id,e)},domProps:{value:s.details.id}},[t._v("\n                  "+t._s(s.name)+"\n                  "),"0.00"!==s.details.price?n("span",[t._v("\n                    ("+t._s(t._f("currency")(s.details.price))+")\n                  ")]):t._e(),t._v(" "),s.details.duration>1?n("span",[t._v("\n                    ("+t._s(s.details.duration)+" periods)\n                  ")]):t._e(),t._v(" "),t.sizeInfoForOffering(t.event.id,s.details.id)?n("span",[t._v("\n                    ("+t._s(t.sizeInfoText(s.details.id,e))+")\n                  ")]):t._e()])}))])])])])}))]),t._v(" "),n("div",{staticClass:"field is-grouped"},[n("div",{staticClass:"control"},[n("button",{staticClass:"button is-primary",class:{"is-loading":t.saving},attrs:{disabled:t.saving},on:{click:function(e){t.setAssignments()}}},[t._v("Save Assignments")])]),t._v(" "),n("div",{staticClass:"control"},[n("button",{staticClass:"button",attrs:{disabled:t.saving},on:{click:function(e){t.$emit("done")}}},[t._v("Cancel")])])])])},[],!1,null,"103cd2d6",null);e.a=c.exports},qvGm:function(t,e,n){"use strict";var s=n("0TjF");n.n(s).a},tjPp:function(t,e,n){"use strict";e.a={props:{registration:{type:Object,required:!0},event:{type:Object,required:!0}},computed:{assignments:function(){return this.registration.assignments},assignmentList:function(){var t=[null,null,null];return _.forEach(this.registration.assignments,function(e){return _.forEach(e.details.periods,function(n){t[Number(n)-1]=e})}),t},scout:function(){return this.registration.scout},preferences:function(){return _.orderBy(this.registration.preferences,["details.rank"])},purchases:function(){return this.registration.purchases},registrationAssignments:function(){return _.map(_.omitBy(this.assignmentList,_.isNil),function(t){return{name:t.badge.name,price:t.price,periods:t.details.periods}})},registrationPreferences:function(){return _.map(this.preferences,function(t){return{name:t.badge.name,price:t.price}})},registrationPurchases:function(){return _.map(this.purchases,function(t){return{price:t.price,size:t.details.size,item:t.item,quantity:t.details.quantity,id:t.id}})}}}},yDlJ:function(t,e,n){"use strict";var s=n("yzNI");n.n(s).a},yzNI:function(t,e,n){}}]);
//# sourceMappingURL=attendance.6b00e92ef962804176b4.js.map