(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["coordinator~scouts~teacher"],{"123a":function(t,e,s){},"25cf":function(t,e,s){"use strict";s("7514");var n=s("c93e"),r=s("2ef0"),i=s.n(r),o=s("2f62");e["a"]={data:function(){return{classesLoading:!1,classLoadError:""}},computed:Object(n["a"])({},Object(o["b"])(["eventClasses"])),methods:{sizeInfoForOffering:function(t,e){var s=this.classesForEvent(t),n=i.a.find(s,{offering_id:e})||{};return n.sizeInfo},classesForEvent:function(t){return this.eventClasses[t]||[]},hasClassInfoForEvent:function(t){var e=this.classesForEvent(t);return e&&e.length>0&&e[0].sizeInfo},loadClasses:function(t){var e=this;this.classesLoading=!0,this.$store.dispatch("getClasses",t).then(function(s){return e.getSizesForBadges(t,i.a.map(s,"badge.badge_id"))}).then(function(){e.classLoadError=""}).catch(function(){e.classLoadError="Failed to get classes for this event"}).then(function(){e.classesLoading=!1})},getSizesForBadges:function(t,e){var s=this;return new Promise(function(n,r){s.$store.dispatch("getClassSizes",{eventId:t,badgeIds:e}).then(function(){return n()}).catch(function(){return r()})})}}}},"2fdb":function(t,e,s){"use strict";var n=s("5ca1"),r=s("d2c8"),i="includes";n(n.P+n.F*s("5147")(i),"String",{includes:function(t){return!!~r(this,t,i).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},"386d":function(t,e,s){s("214f")("search",1,function(t,e,s){return[function(s){"use strict";var n=t(this),r=void 0==s?void 0:s[e];return void 0!==r?r.call(s,n):new RegExp(s)[e](String(n))},s]})},5147:function(t,e,s){var n=s("2b4c")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(s){try{return e[n]=!1,!"/./"[t](e)}catch(t){}}return!0}},6762:function(t,e,s){"use strict";var n=s("5ca1"),r=s("c366")(!0);n(n.P,"Array",{includes:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),s("9c6c")("includes")},"7c19":function(t,e,s){"use strict";s("ac6a");e["a"]={data:function(){return{eventLoading:!1,eventLoadError:""}},created:function(){var t=this;this.eventLoading=!0,Promise.all([this.$store.dispatch("getEvents"),this.$store.dispatch("getCurrentEvent")]).then(function(){t.eventLoadError=""}).catch(function(){t.eventLoadError="Failed to fetch event data. Please refresh to try again."}).then(function(){t.eventLoading=!1})}}},"7fc2":function(t,e,s){"use strict";var n=s("84a6"),r=s.n(n);r.a},"84a6":function(t,e,s){},"8dc7":function(t,e,s){},a1f2:function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"box filters"},[s("div",{staticClass:"columns is-multiline"},[s("div",{staticClass:"column is-6"},[s("horizontal-field",[s("span",{attrs:{slot:"field-label"},slot:"field-label"},[t._v("Registered:")]),s("events-dropdown",{attrs:{slot:"field-contents"},on:{select:function(e){t.updateQuery("eventId",Number(e))}},slot:"field-contents"})],1)],1),s("div",{staticClass:"column is-6"},[s("horizontal-field",[s("span",{attrs:{slot:"field-label"},slot:"field-label"},[t._v("Troop:")]),s("span",{staticClass:"input-group select",attrs:{slot:"field-contents"},slot:"field-contents"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.troopProp,expression:"troopProp"}],staticClass:"input",on:{change:[function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.troopProp=e.target.multiple?s:s[0]},function(e){t.updateQuery("troop",e.target.value?Number(e.target.value):null)}]}},[s("option",{domProps:{value:null}},[t._v("All Troops")]),t._l(t.troops,function(e){return s("option",{key:e,domProps:{value:e}},[t._v("\n              "+t._s(e)+"\n            ")])})],2)])])],1),s("div",{staticClass:"column is-6"},[s("horizontal-field",[s("span",{attrs:{slot:"field-label"},slot:"field-label"},[t._v("Name:")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.searchProp,expression:"searchProp"}],staticClass:"input is-expanded",attrs:{slot:"field-contents",id:"scout-list-find"},domProps:{value:t.searchProp},on:{input:[function(e){e.target.composing||(t.searchProp=e.target.value)},function(e){t.updateQuery("search",e.target.value)}]},slot:"field-contents"})])],1),s("div",{staticClass:"column is-6"},[s("div",{staticClass:"field is-grouped"},[s("div",{staticClass:"control is-pulled-right"},[s("button",{staticClass:"button is-pulled-right",on:{click:function(e){e.preventDefault(),t.reset()}}},[t._v("Reset Filters")])])])])])])},r=[],i=(s("6762"),s("2fdb"),s("a481"),s("386d"),s("c5f6"),s("2ef0")),o=s.n(i),a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"field is-horizontal"},[s("div",{staticClass:"field-label is-normal"},[s("label",{staticClass:"label"},[t._t("field-label")],2)]),s("div",{staticClass:"field-body"},[s("div",{staticClass:"field"},[s("div",{staticClass:"control"},[t._t("field-contents")],2)])])])},c=[],l=s("2877"),u={},d=Object(l["a"])(u,a,c,!1,null,null,null);d.options.__file="HorizontalField.vue";var f=d.exports,p={props:{eventId:Number,troop:Number,search:String,troops:Array},data:function(){return{eventIdProp:this.eventId,troopProp:this.troop,searchProp:this.search}},methods:{reset:function(){this.troopProp=null,this.searchProp=null,this.updateQuery("troop",null),this.updateQuery("search","")},sendUpdate:function(t,e){this.$emit("update:"+t,e)},updateQuery:function(t,e){var s=o.a.clone(this.$route.query);null===e?delete s[t]:s[t]=e,this.$router.replace({query:s}),this.sendUpdate(t,e)}},watch:{troopProp:function(t,e){void 0===t&&(this.troopProp=e)},troops:function(){o.a.includes(this.troops,this.troopProp)||(this.troopProp=null,this.updateQuery("troop",null))}},mounted:function(){var t=this.$route.query;t.troop&&(this.troopProp=t.troop,this.sendUpdate("troop",Number(t.troop))),t.eventId&&(this.eventIdProp=t.eventId,this.sendUpdate("eventId",Number(t.eventId))),t.search&&(this.searchProp=t.search,this.sendUpdate("search",t.search))},components:{HorizontalField:f}},h=p,v=Object(l["a"])(h,n,r,!1,null,null,null);v.options.__file="FilterBox.vue";e["a"]=v.exports},d218:function(t,e,s){"use strict";var n=s("8dc7"),r=s.n(n);r.a},d2c8:function(t,e,s){var n=s("aae3"),r=s("be13");t.exports=function(t,e,s){if(n(e))throw TypeError("String#"+s+" doesn't accept regex!");return String(r(t))}},e35e:function(t,e,s){"use strict";var n=s("123a"),r=s.n(n);r.a},f4c8:function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.eventLoading?s("spinner-page"):s("div",[s("filter-box",{staticClass:"attendance-list-filters",attrs:{troop:t.troopFilter,eventId:t.eventId,search:t.search,troops:t.troops},on:{"update:troop":function(e){t.troopFilter=e},"update:eventId":function(e){t.eventId=e},"update:search":function(e){t.search=e}}}),t.error?s("closable-error",{on:{dismissed:function(e){t.dismissError()}}},[t._v(t._s(t.error))]):t._e(),t.loading?s("spinner-page"):s("div",{attrs:{id:"printable"}},[t.filteredRegistrations.length>0?s("div",{staticClass:"attendance-list"},[s("div",{staticClass:"box stats-container"},[s("h5",{staticClass:"title is-5"},[t._v("\n            Event Overview for "+t._s(t.event.semester)+" "+t._s(t.event.year)+"\n            "),s("div",{staticClass:"is-pulled-right"},[t.printing?t._e():s("button",{staticClass:"button print-hidden",on:{click:function(e){t.print()}}},[s("span",{staticClass:"icon is-small"},[s("i",{staticClass:"fa fa-print"})]),s("span",[t._v("Print")])])])]),s("troop-stats",{attrs:{event:this.event,registrations:this.filteredRegistrations}})],1),s("div",{staticClass:"tabs is-centered print-hidden"},[s("ul",[s("router-link",{attrs:{to:t.listLink,tag:"li"}},[s("a",[t._v("List View")])]),s("router-link",{attrs:{to:t.detailLink,tag:"li"}},[s("a",[t._v("Detail View")])])],1)]),s("div",{attrs:{id:"print-break-before"}}),s("router-view",{attrs:{event:this.event,classes:t.classesForEvent(this.eventId),registrations:this.filteredRegistrations}})],1):s("div",{staticClass:"notification"},[s("p",[t._v("\n          No attendance records match the selected filters. Try selecting a different event,\n          or searching for another scout.\n        ")])])])],1)],1)},r=[],i=(s("386d"),s("7514"),s("c93e")),o=s("2f62"),a=s("7c19"),c=s("25cf"),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("ul",[t.isTeacher?t._e():s("span",[s("li",[s("b",[t._v(t._s(t.isCoordinator?"Total Due":"Total Income")+" (all scouts):")]),t.totalDue?s("span",[t._v(t._s(t._f("currency")(t.totalDue)))]):s("span",[t._v("Calculating...")])]),s("br")]),s("li",[s("b",[t._v("Showing Information for: ")]),t._v("\n      "+t._s(t.registrations.length)+" "+t._s(1==t.registrations.length?"scout":"scouts")+"\n    ")]),s("li",[s("b",[t._v("\n        Total for "+t._s(t.registrations.length)+" "+t._s(1==t.registrations.length?"scout":"scouts")+"\n        shown:\n      ")]),s("span",[t._v(t._s(t._f("currency")(t.subtotal)))])]),s("br"),s("li",[s("b",[t._v("Event Registration Fees")]),s("span",[t._v("\n        "+t._s(t._f("currency")(t.registrations.length*Number(t.event.price)))+" ("+t._s(t.registrations.length)+" × "+t._s(t._f("currency")(t.event.price))+")\n      ")])]),s("li",[s("b",[t._v("Merit Badge Fees:")]),s("span",[t._v(t._s(t._f("currency")(t.subcost("assignments"))))])]),s("li",[s("b",[t._v("Purchase Costs:")]),s("span",[t._v(t._s(t._f("currency")(t.subcost("purchases"))))])]),s("purchased-items",{staticClass:"purchased-items",attrs:{registrations:t.registrations}})],1)])},u=[],d=(s("c5f6"),s("2ef0")),f=s.n(d),p=s("bc3a"),h=s.n(p),v=s("3fab"),g=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("ul",t._l(t.groupedPurchases,function(e,n){return s("li",{key:n},[e.hasSize?s("span",[s("b",[t._v(t._s(n)+":")]),s("ul",{staticClass:"subtotal"},t._l(t.sizes,function(n){return s("li",{key:n},[s("b",{staticClass:"uppercase"},[t._v(t._s(n)+":")]),e.items[n]?s("span",[t._v("\n              "+t._s(t._f("currency")(t.totalDue(e.items[n])))+"\n              ("+t._s(t.totalQuantity(e.items[n]))+" ×\n              "+t._s(t._f("currency")(e.items[n][0].price))+")\n            ")]):s("span",[t._v("\n              No purchases\n            ")])])}))]):s("span",[s("b",[t._v(t._s(n)+":")]),t._v("\n        "+t._s(t._f("currency")(t.totalDue(e)))+"\n        ("+t._s(t.totalQuantity(e))+" × "+t._s(t._f("currency")(e[0].price))+")\n      ")])])}))])},m=[],b=(s("ac6a"),{props:{registrations:{type:Array,required:!0}},data:function(){return{sizes:["xs","s","m","l","xl"]}},computed:{purchases:function(){return f.a.chain(this.registrations).map("purchases").flatten().groupBy("item").value()},groupedPurchases:function(){var t=f.a.cloneDeep(this.purchases);return f.a.forEach(this.purchases,function(e,s){if(e[0].has_size){t[s]={hasSize:!0,items:[]};var n=f.a.chain(e).groupBy("details.size").value();t[s].items=n}}),t}},methods:{totalDue:function(t){return f.a.reduce(t,function(t,e){return t+Number(e.price)*Number(e.details.quantity)},0)},totalQuantity:function(t){return f.a.reduce(t,function(t,e){return t+Number(e.details.quantity)},0)}}}),y=b,C=(s("7fc2"),s("2877")),P=Object(C["a"])(y,g,m,!1,null,null,null);P.options.__file="PurchasedItems.vue";var I=P.exports,E={props:{event:{type:Object,required:!0},registrations:{type:Array,required:!0}},data:function(){return{error:"",loading:!1,totalDue:null}},computed:Object(i["a"])({},Object(o["b"])(["profile","isTeacher"]),{isCoordinator:function(){return"coordinator"===this.profile.role},subtotal:function(){return this.subcost("assignments")+this.subcost("purchases")+this.registrations.length*Number(this.event.price)}}),methods:{subcost:function(t){return t?f.a.reduce(this.registrations,function(e,s){return e+f.a.reduce(s[t],function(t,e){return t+Number(e.price)*(Number(e.details.quantity)||1)},0)},0):0}},mounted:function(){var t=this;if(this.registrations.length>0&&!this.isTeacher){var e=this.isCoordinator?v["a"].USERS_URL+this.profile.id+"/events/"+this.event.id+"/cost":v["a"].EVENTS_URL+this.event.id+"/income";return h.a.get(e).then(function(e){t.totalDue=t.isCoordinator?e.data.cost:e.data.income,t.error=""}).catch(function(){t.error="Failed to get the necessary information for statistics."}).then(function(){t.loading=!1})}},components:{PurchasedItems:I}},F=E,w=(s("e35e"),Object(C["a"])(F,l,u,!1,null,null,null));w.options.__file="TroopStats.vue";var L=w.exports,x=s("a1f2"),N={props:{listLink:{type:String,required:!0},detailLink:{type:String,required:!0}},data:function(){return{eventId:0,error:"",loading:!1,search:"",troopFilter:null,printing:!1}},computed:Object(i["a"])({},Object(o["b"])(["allEvents","registrations","isCoordinator"]),{event:function(){return _.find(this.allEvents,{id:this.eventId})},filteredRegistrations:function(){var t,e=this;return this.selectedRegistration?(t=this.troopFilter?_.filter(this.selectedRegistration,function(t){return t.scout.troop===e.troopFilter}):this.selectedRegistration,t=_.filter(t,function(t){return t.scout.fullname.toLowerCase().indexOf(e.search.toLowerCase())>-1}),_.orderBy(t,["scout.troop"])):{}},selectedRegistration:function(){return this.registrations[this.eventId]||[]},troops:function(){return this.selectedRegistration?_.orderBy(_.uniq(_.map(this.selectedRegistration,"scout.troop"))):[]}}),methods:{dismissError:function(){this.error=""},print:function(){window.print()}},watch:{eventId:function(){var t=this;this.loading=!0,this.totalDue=null,!this.hasClassInfoForEvent(this.eventId)&&this.isCoordinator&&this.loadClasses(this.eventId),this.$store.dispatch("getRegistrations",this.eventId).then(function(){t.error=""}).catch(function(){t.error="Failed to get registration information for this event"}).then(function(){t.loading=!1})}},components:{FilterBox:x["a"],TroopStats:L},mixins:[a["a"],c["a"]]},S=N,z=(s("d218"),Object(C["a"])(S,n,r,!1,null,"69108d13",null));z.options.__file="StatsList.vue";e["a"]=z.exports}}]);
//# sourceMappingURL=coordinator~scouts~teacher.6413b2fb.js.map