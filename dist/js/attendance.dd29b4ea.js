(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["attendance"],{"23ef":function(e,t,n){},"25cf":function(e,t,n){"use strict";var s=n("795b"),i=n.n(s),r=(n("7514"),n("cebc")),a=n("2ef0"),o=n.n(a),c=n("2f62");t["a"]={data:function(){return{classesLoading:!1,classLoadError:""}},computed:Object(r["a"])({},Object(c["b"])(["eventClasses"])),methods:{sizeInfoForOffering:function(e,t){var n=this.classesForEvent(e),s=o.a.find(n,{offering_id:t})||{};return s.sizeInfo},classesForEvent:function(e){return this.eventClasses[e]||[]},hasClassInfoForEvent:function(e){var t=this.classesForEvent(e);return t&&t.length>0&&t[0].sizeInfo},loadClasses:function(e){var t=this;this.classesLoading=!0,this.$store.dispatch("getClasses",e).then(function(n){return t.getSizesForBadges(e,o.a.map(n,"badge.badge_id"))}).then(function(){t.classLoadError=""}).catch(function(){t.classLoadError="Failed to get classes for this event"}).then(function(){t.classesLoading=!1})},getSizesForBadges:function(e,t){var n=this;return new i.a(function(s,i){n.$store.dispatch("getClassSizes",{eventId:e,badgeIds:t}).then(function(){return s()}).catch(function(){return i()})})}}}},2682:function(e,t,n){},3121:function(e,t,n){"use strict";var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"columns"},[e.showProjectedCost?n("p",{staticClass:"column is-6"},[n("b",[e._v("Projected Costs: ")]),e._v(e._s(e._f("currency")(e.projectedCost))+"\n      "),n("ul",{staticClass:"itemized-list"},[n("li",[e._v("Event Fee: "+e._s(e._f("currency")(e.event.price)))]),n("li",[e._v("Merit Badge Fees: "+e._s(e._f("currency")(e.preferenceCosts)))]),n("li",[e._v("Purchases: "+e._s(e._f("currency")(e.purchaseCosts)))])])]):e._e(),e.showActualCost?n("p",{staticClass:"column is-6"},[n("b",[e._v("Actual Costs: ")]),e._v(e._s(e._f("currency")(e.actualCost))+"\n      "),n("ul",{staticClass:"itemized-list"},[n("li",[e._v("Event Fee: "+e._s(e._f("currency")(e.event.price)))]),n("li",[e._v("Merit Badge Fees: "+e._s(e._f("currency")(e.assignmentCosts)))]),n("li",[e._v("Purchases: "+e._s(e._f("currency")(e.purchaseCosts)))])])]):e._e()]),e.showPreferences?n("div",{staticClass:"registration-section"},[n("b",[e._v("Merit Badge Preferences:")]),e.preferences.length>0?n("div",{staticClass:"preference-list"},[n("ol",e._l(e.preferences,function(t){return n("li",{key:t.name},[e._v("\n          "+e._s(t.name)+"\n          "),"0.00"!==t.price?n("span",[e._v("\n            ("+e._s(e._f("currency")(t.price))+")\n          ")]):e._e()])}),0)]):n("div",{staticClass:"notification"},[e._t("preference-notification",[e._v("\n        This scout does not have any preferences listed for this event.\n      ")])],2)]):e._e(),e.purchases.length>0?n("div",{staticClass:"registration-section"},[n("b",[e._v("Purchased Items:")]),n("ul",{staticClass:"itemized-list"},e._l(e.purchases,function(t){return n("li",{key:t.id},[e._v("\n        "+e._s(t.item)+":\n        "),t.size?n("span",[e._v("\n          (Size "+e._s(e._f("upperCase")(t.size))+")\n        ")]):e._e(),e._v("\n        "+e._s(e._f("currency")(t.price))+" Ã— "+e._s(t.quantity)+" = "+e._s(e._f("currency")(t.price*t.quantity))+"\n      ")])}),0)]):e._e(),e.showAssignments?n("div",{staticClass:"registration-section"},[n("b",[e._v("Assignments:")]),e.assignments.length<1?n("div",{staticClass:"attendance-section"},[n("div",{staticClass:"notification"},[e._t("assignment-notification",[e._v("\n          No Merit Badges have been assigned for MBU "+e._s(e.event.semester)+" "+e._s(e.event.year)+".\n        ")])],2)]):n("div",[n("ul",{staticClass:"itemized-list"},e._l(e.assignments,function(t,s){return n("li",{key:s},[e._v("\n          Period "+e._s(s+1)+":\n          "),n("span",t?[e._v("\n            "+e._s(t.badge.name)+"\n            "),"0.00"!==t.price?n("span",[e._v("\n              ("+e._s(e._f("currency")(t.price))+")\n            ")]):e._e(),n("div",{staticClass:"completions"},[e._v("\n              Completions:\n              "),t.details.completions.length>0?n("span",[e._v("\n                "+e._s(e._f("commaSeparated")(e._f("numAlphaSort")(t.details.completions)))+"\n              ")]):n("span",[e._v("\n                No completions recorded yet\n              ")])])]:[e._v("Unassigned")])])}),0)])]):e._e()])},i=[],r=(n("c5f6"),n("2ef0")),a=n.n(r),o={props:{event:{type:Object,required:!0},preferences:{type:Array,default:function(){return[]}},purchases:{type:Array,default:function(){return[]}},assignments:{type:Array,default:function(){return[]}},showAssignments:{type:Boolean,default:!0},showPreferences:{type:Boolean,default:!0},showActualCost:{type:Boolean,default:!0},showProjectedCost:{type:Boolean,default:!0}},computed:{actualCost:function(){return Number(this.event.price)+Number(this.assignmentCosts)+Number(this.purchaseCosts)},assignmentCosts:function(){return a.a.reduce(a.a.uniqBy(this.assignments,"offering_id"),function(e,t){return t?e+Number(t.price):e},0)},preferenceCosts:function(){return a.a.reduce(this.preferences,function(e,t){return e+Number(t.price)},0)},projectedCost:function(){return Number(this.event.price)+Number(this.preferenceCosts)+Number(this.purchaseCosts)},purchaseCosts:function(){return a.a.reduce(this.purchases,function(e,t){return e+Number(t.price)*Number(t.quantity)},0)}}},c=o,u=(n("fb7a"),n("2877")),f=Object(u["a"])(c,s,i,!1,null,"1c92dc66",null);t["a"]=f.exports},"56b9":function(e,t,n){"use strict";var s=n("2682"),i=n.n(s);i.a},"7c19":function(e,t,n){"use strict";var s=n("795b"),i=n.n(s);n("ac6a"),n("5df3");t["a"]={data:function(){return{eventLoading:!1,eventLoadError:""}},created:function(){var e=this;this.eventLoading=!0,i.a.all([this.$store.dispatch("getEvents"),this.$store.dispatch("getCurrentEvent")]).then(function(){e.eventLoadError=""}).catch(function(){e.eventLoadError="Failed to fetch event data. Please refresh to try again."}).then(function(){e.eventLoading=!1})}}},"7e7b":function(e,t,n){"use strict";var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b",[e._v("Assign Merit Badges")]),n("p",[e._v("\n    Assign Merit Badges for "+e._s(e.scout.fullname)+" for MBU "+e._s(e.event.semester)+" "+e._s(e.event.year)+" here. Select\n    a merit badge from the dropdown for each period. Merit Badges that are not offered for that period\n    are grayed out.\n  ")]),n("br"),n("p",[e._v("\n    "+e._s(e.scout.fullname)+" has listed as their preferences:\n  ")]),n("ul",e._l(e.preferences,function(t){return n("li",{key:t.offering_id},[e._v("\n      "+e._s(t.details.rank)+": "+e._s(t.badge.name)+"\n      "),"0.00"!==t.price?n("span",[e._v("\n        ("+e._s(e._f("currency")(t.price))+")\n      ")]):e._e()])}),0),n("form",{staticClass:"form"},[n("div",{staticClass:"columns"},e._l(3,function(t){return n("div",{key:t,staticClass:"field column is-4"},[n("label",{staticClass:"label",attrs:{for:"period-1-assignment"}},[e._v("Period "+e._s(t)+":")]),n("div",{staticClass:"control"},[n("span",{staticClass:"input-group select"},[n("select",{directives:[{name:"model",rawName:"v-model",value:e.assignments[t-1],expression:"assignments[n - 1]"}],staticClass:"input",attrs:{id:"period-"+t+"-assignment"},on:{change:[function(n){var s=Array.prototype.filter.call(n.target.options,function(e){return e.selected}).map(function(e){var t="_value"in e?e._value:e.value;return t});e.$set(e.assignments,t-1,n.target.multiple?s:s[0])},function(n){return e.maybeRespondToDuration(n.target.value,t)}]}},[n("option",{domProps:{value:null}},[e._v("No Assignment")]),n("option",{attrs:{disabled:""}}),n("optgroup",{attrs:{label:"Preferences"}},e._l(e.preferences,function(s){return n("option",{key:s.offering_id,attrs:{disabled:!e.offered(s.offering_id,t)||e.classFull(s.offering_id,t)},domProps:{value:s.offering_id}},[e._v("\n                  "+e._s(s.badge.name)+"\n                  "),"0.00"!==s.price?n("span",[e._v("\n                    ("+e._s(e._f("currency")(s.price))+")\n                  ")]):e._e(),s.duration>1?n("span",[e._v("\n                    ("+e._s(s.duration)+" periods)\n                  ")]):e._e(),e.sizeInfoForOffering(e.event.id,s.offering_id)?n("span",[e._v("\n                    ("+e._s(e.sizeInfoText(s.offering_id,t))+")\n                  ")]):e._e()])}),0),n("option",{attrs:{disabled:""}}),n("optgroup",{attrs:{label:"All Offerings"}},e._l(e.sortedOfferings,function(s){return n("option",{key:s.details.id,attrs:{disabled:!e.offered(s.details.id,t)||e.classFull(s.details.id,t)},domProps:{value:s.details.id}},[e._v("\n                  "+e._s(s.name)+"\n                  "),"0.00"!==s.details.price?n("span",[e._v("\n                    ("+e._s(e._f("currency")(s.details.price))+")\n                  ")]):e._e(),s.details.duration>1?n("span",[e._v("\n                    ("+e._s(s.details.duration)+" periods)\n                  ")]):e._e(),e.sizeInfoForOffering(e.event.id,s.details.id)?n("span",[e._v("\n                    ("+e._s(e.sizeInfoText(s.details.id,t))+")\n                  ")]):e._e()])}),0)])])])])}),0)]),n("div",{staticClass:"field is-grouped"},[n("div",{staticClass:"control"},[n("button",{staticClass:"button is-primary",class:{"is-loading":e.saving},attrs:{disabled:e.saving},on:{click:function(t){return e.setAssignments()}}},[e._v("Save Assignments")])]),n("div",{staticClass:"control"},[n("button",{staticClass:"button",attrs:{disabled:e.saving},on:{click:function(t){return e.$emit("done")}}},[e._v("Cancel")])])])])},i=[],r=(n("ac6a"),n("c5f6"),n("7514"),n("2ef0")),a=n.n(r),o=n("25cf"),c={props:{scout:{type:Object,required:!0},event:{type:Object,required:!0},preferences:{type:Array,default:function(){return[]}},registration:{type:Object,require:!0},classes:{type:Array,default:function(){return[]}}},data:function(){return{assignments:[],saving:!1}},computed:{sortedOfferings:function(){return a.a.orderBy(this.event.offerings,"name")}},methods:{classFull:function(e,t){return this.sizeInfoForOffering(this.event.id,e)[t]>=this.sizeInfoForOffering(this.event.id,e).size_limit},maybeRespondToDuration:function(e){var t=a.a.find(this.event.offerings,function(t){return t.details.id===Number(e)});!t||t.details.duration<2||(this.assignments[1]=e,this.assignments[2]=e)},offered:function(e,t){var n=a.a.find(this.event.offerings,function(t){return t.details.id===e});return a.a.indexOf(n.details.periods,t)>=0},setAssignments:function(){var e=this;this.saving=!0;var t=[];a.a.forEach(this.assignments,function(n,s){if(n){var i=a.a.find(t,{offering:n}),r=a.a.find(e.registration.assignments,{offering_id:n});i?i.periods.push(s+1):t.push({periods:[s+1],offering:n,completions:r&&r.details.completions||[]})}}),this.$store.dispatch("setAssignments",{scoutId:this.scout.scout_id,registrationId:this.registration.id,assignments:t,eventId:this.event.id}).then(function(){e.loadClasses(e.event.id)}).then(function(){e.error="",e.$emit("done")}).catch(function(){e.error="Failed to save assignments. Please refresh and try again"}).then(function(){e.saving=!1})},sizeInfoText:function(e,t){return"".concat(this.sizeInfoForOffering(this.event.id,e)[t]," of ").concat(this.sizeInfoForOffering(this.event.id,e).size_limit)}},mounted:function(){var e=[null,null,null];a.a.forEach(this.registration.assignments,function(t){return a.a.forEach(t.details.periods,function(n){e[Number(n)-1]=t.offering_id})}),this.assignments=e},mixins:[o["a"]]},u=c,f=(n("56b9"),n("2877")),l=Object(f["a"])(u,s,i,!1,null,"69366fcd",null);t["a"]=l.exports},"8e24":function(e,t,n){},a94e:function(e,t,n){"use strict";var s=n("23ef"),i=n.n(s);i.a},aba6:function(e,t,n){},b633:function(e,t,n){"use strict";n("7f7f"),n("c5f6"),n("ac6a");var s=n("2ef0"),i=n.n(s);t["a"]={props:{registration:{type:Object,required:!0},event:{type:Object,required:!0}},computed:{assignments:function(){return this.registration.assignments},assignmentList:function(){var e=[null,null,null];return i.a.forEach(this.registration.assignments,function(t){return i.a.forEach(t.details.periods,function(n){e[Number(n)-1]=t})}),e},scout:function(){return this.registration.scout},preferences:function(){return i.a.orderBy(this.registration.preferences,["details.rank"])},purchases:function(){return this.registration.purchases},registrationAssignments:function(){return i.a.map(i.a.omitBy(this.assignmentList,i.a.isNil),function(e){return{name:e.badge.name,price:e.price,periods:e.details.periods}})},registrationPreferences:function(){return i.a.map(this.preferences,function(e){return{name:e.badge.name,price:e.price}})},registrationPurchases:function(){return i.a.map(this.purchases,function(e){return{price:e.price,size:e.details.size,item:e.item,quantity:e.details.quantity,id:e.id}})}}}},e7bb:function(e,t,n){"use strict";var s=n("8e24"),i=n.n(s);i.a},f4a9:function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.loading?n("spinner-page"):n("div",{staticClass:"registration-list"},[e.error?n("closable-error",[e._v(e._s(e.error))]):e._e(),e.registrations.length>0?n("div",[n("paginated-items",{attrs:{target:"registrations",contents:e.registrations,per:10,showLinks:!0},scopedSlots:e._u([{key:"row",fn:function(t){return[n("attendance-row",{attrs:{registration:t.item,event:e.event,classes:e.classes}})]}}],null,!1,4084567784)})],1):n("div",{staticClass:"notification"},[n("p",[e._v("\n        There are no scouts that match the criteria you specified.\n      ")])])],1)],1)},i=[],r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"attendance-row"},[n("h5",{staticClass:"title is-5"},[e._v("\n    Attendance for "+e._s(e.scout.fullname)+" (Troop "+e._s(e.scout.troop)+")\n    "),"displaying"===e.state?n("button",{staticClass:"button edit-button is-pulled-right",on:{click:function(t){return e.toggleState("assigning")}}},[n("span",{staticClass:"fa fa-edit",attrs:{"aria-label":"Edit"}})]):e._e()]),"displaying"===e.state?n("div",[n("scout-registration",{attrs:{event:e.event,preferences:e.registrationPreferences,purchases:e.registrationPurchases,assignments:e.assignmentList}},[n("p",{attrs:{slot:"assignment-notification"},slot:"assignment-notification"},[e._v("\n        "+e._s(e.scout.fullname)+" has not yet been assigned any merit badges for\n        MBU "+e._s(e.event.semester)+" "+e._s(e.event.year)+".\n        "),n("br"),n("a",{staticClass:"is-text",on:{click:function(t){return t.preventDefault(),e.toggleState("assigning")}}},[e._v("\n          Assign Merit Badges\n        ")])])])],1):e._e(),"assigning"===e.state?n("assignment-edit",{attrs:{scout:e.scout,classes:e.classes,event:e.event,preferences:e.preferences,registration:e.registration},on:{done:function(t){return e.toggleState("displaying")}}}):e._e()],1)},a=[],o=n("7e7b"),c=n("3121"),u=n("b633"),f={props:{classes:{type:Array,default:function(){return[]}}},data:function(){return{state:"displaying"}},watch:{registration:function(){this.state="displaying"}},methods:{toggleState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"displaying";this.state=e}},components:{AssignmentEdit:o["a"],ScoutRegistration:c["a"]},mixins:[u["a"]]},l=f,d=(n("e7bb"),n("2877")),p=Object(d["a"])(l,r,a,!1,null,"7e280283",null),g=p.exports,v=n("7c19"),_=n("2ef0"),h=n.n(_),m={props:{event:{type:Object},registrations:{type:Array,required:!0},classes:{type:Array,default:function(){return[]}}},data:function(){return{error:"",loading:!1,search:"",selectedEventId:0,troopFilter:null}},computed:{noRegistrations:function(){return!this.selectedRegistration||this.selectedRegistration.registrations.length<1},troops:function(){return this.selectedRegistration?h.a.uniq(h.a.map(this.selectedRegistration.registrations,"scout.troop")):[]}},watch:{selectedEventId:function(e){var t=this;this.loading=!0,this.troopFilter=null,this.$store.dispatch("getRegistrations",e).then(function(){t.error=""}).catch(function(){t.error="Failed to get registrations for this event"}).then(function(){t.loading=!1})}},components:{AttendanceRow:g},mixins:[v["a"]]},b=m,y=(n("a94e"),Object(d["a"])(b,s,i,!1,null,"01c1e4c5",null));t["default"]=y.exports},fb7a:function(e,t,n){"use strict";var s=n("aba6"),i=n.n(s);i.a}}]);
//# sourceMappingURL=attendance.dd29b4ea.js.map